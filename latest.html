<!DOCTYPE html>
<html>
  <head>
    <!-- Global site tag (gtag.js) - Google Analytics -->
<script async src="https://www.googletagmanager.com/gtag/js?id=UA-37528940-3"></script>
<script>
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());

  gtag('config', 'UA-37528940-3');
</script>

<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1, minimum-scale=1, maximum-scale=1, user-scalable=no">
<meta name="google-site-verification" content="4cR7WuQWEtkbu8ThfxGkT1vACiVi5Q_8ykfkRudOnTU" />

<link rel="shortcut icon" href="/images/favicon.png">

<link rel="stylesheet" type="text/css" href="/css/common.css">
<script type="text/javascript" src="/js/jquery-1.9.0.min.js"></script>
<script type="text/javascript" src="/js/google-code-prettify/prettify.js"></script>
<link  type="text/css" rel="stylesheet" href="/js/google-code-prettify/prettify.css"/>
<script>
  $(function(){
    // google code prettifyの有効化
    $("pre").addClass("prettyprint");
    function init(event){
      prettyPrint();
    }
    if(window.addEventListener)window.addEventListener("load",init,false);
    else if(window.attachEvent)window.attachEvent("onload",init);
    
    $(".to-top").click(function() {
      // ページの一番上までスクロールさせます。
      $('body, html').animate({scrollTop: 0}, 300, 'linear');;
    });
  });
</script>

  </head>
  <body>
    <div class="container">
      <div class="header">
        <h1>
  <a href="/"><img src="/images/logo.png"><span style="font-size:105%">Perl</span>入門ゼミ</a>
</h1>
<div class="header-description">
  テキスト処理、Linuxサーバー管理、Web開発ならPerl
</div>
<div class="header-otoiawase">
  <div style="display:table-cell;padding-right:3px;">
    <a rel="nofollow" style="" href="https://twitter.com/perlzemi" title="Twitter" style="padding-right:3px;"><img style="width:37px" src="/images/Twitter_Social_Icon_Square_Color.png"></a>
  </div>
  <div style="display:table-cell;vertical-align:top;">
    <a rel="nofollow" style="display:block;width:100%;background:#F048A4;color:white;text-decoration:none;padding:3px;" href="https://perlzemi.slack.com">フォーラムへ<br>ログイン</a>
  </div>
</div>

      </div>
      <div class="main">
        <div class="content">
          <div class="entry">
  <div class="top">
    <!-- entry-top -->

  </div>
  <div class="middle">
    <div style="font-weight:bold;font-size:18px;letter-spacing:2px;margin:35px 0 0px 0;padding-left:5px;padding-top:5px;border-top:2px solid #ddd">2020/01/01</div>
<ol class="bread" itemscope itemtype="http://schema.org/BreadcrumbList">
  <li itemprop="itemListElement" itemscope itemtype="http://schema.org/ListItem">
    <a itemprop="item" href="/">
        <span itemprop="name">Perl</span></a>
    <meta itemprop="position" content="1" />
  </li>
  &#8250;
  <li itemprop="itemListElement" itemscope itemtype="http://schema.org/ListItem">
    <a itemprop="item" href="/blog/20191228171433.html">
      <span itemprop="name">帳票作成</span></a>
    <meta itemprop="position" content="2" />
  </li>
  &#8250;
  <li>
    here
  </li>
</ol>
<h2><a href="/blog/20200101082734.html">基本図形の描画と表の作成 - PDF::API2で帳票作成</a></h2>
<p>
  PDF::API2で、表を作成する方法を解説します。
</p>
<p>
  PDF::API2には、直線や塗りつぶし可能な円、三角形、四角形、それ以上の多角形を作成できる機能があります。
</p>
<p>
  直線を書くことができれば、それを組み合わせて表を作成することができます。表に背景色を設定したい場合は、塗りつぶし可能な四角形を書くことで実現できます。
</p>
<p>
  HTMLのテーブルは表を作成するのに使えます。ここでは、以下の構造をPDFの表として表現できるようにしてみましょう。
</p>
<pre>
&lt;table&gt;
  &lt;tr&gt;&lt;td&gt;見出し1&lt;/td&gt;&lt;td&gt;見出し2&lt;/td&gt;&lt;td&gt;見出し3&lt;/td&gt;&lt;/tr&gt;
  &lt;tr&gt;&lt;td&gt;項目&lt;/td&gt;&lt;td&gt;項目&lt;/td&gt;&lt;td&gt;項目&lt;/td&gt;&lt;/tr&gt;
  &lt;tr&gt;&lt;td&gt;項目&lt;/td&gt;&lt;td&gt;項目&lt;/td&gt;&lt;td&gt;項目&lt;/td&gt;&lt;/tr&gt;
&lt;/table&gt;
</pre>
<table>
  <tr><td>見出し1</td><td>見出し2</td><td>見出し3</td></tr>
  <tr><td>項目</td><td>項目</td><td>項目</td></tr>
  <tr><td>項目</td><td>項目</td><td>項目</td></tr>
</table>
<h3>基本的な図形を描画する</h3>
<p>
  まず最初に、表を作成するための基礎として、PDF::API2で基本的な図形を描画してみましょう。
</p>
<h4>グラフィック用のコンテンツオブジェクトを生成</h4>
<p>
  まず最初に、グラフィック用のコンテンツオブジェクトを生成します。ページオブジェクトからgfxメソッドを呼び出すことで、グラフィック用のコンテンツオブジェクトを生成できます。これはPDF::API2::Contentオブジェクトです。
</p>
<pre>
# PDFオブジェクトの生成
my $pdf = PDF::API2-&gt;new;

# ページの作成
my $page = $pdf-&gt;page;

# グラフィック用のコンテンツオブジェクトの生成
my $gfx = $page-&gt;gfx;
</pre>
<h4>線を書く</h4>
<p>
  最も基本的な描画として、PDF::API2で線を書いてみましょう。
</p>
<p>
  moveメソッドで、新しいパスが作成され、始点に移動します。lineメソッドで、パスを終点まで移動します。
</p>
<p>
  まだ、実際に線は書かれません。実際に線を書くには、strokeメソッドを呼び出します。
</p>
<pre>
# 線の始点の設定
my $start_x = 100;
my $start_y = 100;
$gfx-&gt;move($start_x, $start_y);

# 線の終点を設定
my $end_x = 300;
my $end_y = 300;
$gfx-&gt;line($end_x, $end_y);

# 線を描画
$gfx-&gt;stroke;
</pre>
<p>
  PDF::API2の図形の描画では、パスをつなげて描画するという感覚を覚えてください。
</p>
<h4>線の太さを設定</h4>
<p>
  線の太さは、linewidthメソッドで、設定できます。strokeする前に呼び出してください。
</p>
<pre>
# 線の太さの設定
$gfx-&gt;linewidth(3);
</pre>
<p>
  線の幅は、円や多角形を書くときの設定の場合も同じです。
</p>
<h4>線の色を設定</h4>
<p>
  線の色は、strokecolorメソッドで、設定できます。strokeする前に呼び出してください。色は、色名、RGB、CMYKで指定できます。各色に1バイト、2バイト、3バイト、または4バイトの値を持つことができます。たとえば、シアンは%F000または、%FFFF000000000000として設定できます。
</p>
<pre>
# 線の色を設定(色名)
$gfx-&gt;strokecolor('red');

# 線の色を設定(RGB)
$gfx-&gt;strokecolor('#0123ab');

# 線の色を設定(CMYK)
$gfx-&gt;strokecolor('%FF000000');
</pre>
<p>
  線の色は、円や多角形を書くときの設定の場合も同じです。
</p>
<p>
  色の書式は、塗りつぶしの色の設定の場合も同じです。
</p>
<h4>線で囲む</h4>
<p>
  線を書く応用として、線で囲んで三角形を書いてみましょう。lineメソッドで、点をつなげて、最後に始点に戻ります。
</p>
<pre>
# 点P1
my $x1 = 100;
my $y1 = 100;
$gfx-&gt;move($x1, $y1);

# 点P2
my $x2 = 300;
my $y2 = 300;
$gfx-&gt;line($x2, $y2);

# 点P3
my $x3 = 500;
my $y3 = 100;
$gfx-&gt;line($x3, $y3);

# 点P1に戻る
$gfx-&gt;line($x1, $y1);

# 線を描画
$gfx-&gt;stroke;
</pre>
<h4>塗りつぶす</h4>
<p>
  パスで囲むと、塗りつぶすことができます。塗りつぶすにはfillメソッドを使用します。塗りつぶしのデフォルト色は、黒です。fillは、strokeの前に呼び出す必要があることに注意してください。
</p>
<pre>
# 塗りつぶす(strokeの前で)
$gfx-&gt;fill;

# 線を書く
$gfx-&gt;stroke;
</pre>
<p>
  塗りつぶしと線を書くのを同時に行うfillstrokeメソッドもあります。
</p>
<pre>
# 塗りつぶして、線を書く
$gfx-&gt;fillstroke;
</pre>
<h4>塗りつぶしの色を設定</h4>
<p>
  塗りつぶしの色は、fillcolorメソッドで、設定できます。fillする前に呼び出してください。色は、色名、RGB、CMYKで指定できます。各色に1バイト、2バイト、3バイト、または4バイトの値を持つことができます。たとえば、シアンは%F000または、%FFFF000000000000として設定できます。
</p>
<pre>
# 塗りつぶしの色を設定(色名)
$gfx-&gt;fillcolor('red');

# 塗りつぶしの色を設定(RGB)
$gfx-&gt;fillcolor('#0123ab');

# 塗りつぶしの色を設定(CMYK)
$gfx-&gt;fillcolor('%FF000000');
</pre>
<h3>四角形を書く</h3>
<p>
  PDF::API2には、四角形を書くための便利なメソッドがあります。すべての図形は、上記の方法で、線をつなげて作成できますが、線をつなげる方法は、手順が多いので、四角形などの基本的な図形を描画するメソッドが、準備されています。
</p>
<p>
  四角形を作成して、薄いグレーで、背景を塗りつぶしてみましょう。四角形を書くには、rectメソッドとrectxyメソッドがありますが、始点と対角線の向かい側の点を指定するだけで、四角形が書けるrectxyを使ってみましょう。
</p>
<pre>
use strict;
use warnings;
use utf8;

use PDF::API2;

# PDFオブジェクトの生成
my $pdf = PDF::API2-&gt;new;

# ページの作成
my $page = $pdf-&gt;page;

# グラフィック用のコンテンツオブジェクトの生成
my $gfx = $page-&gt;gfx;

# 点P1
my $x1 = 100;
my $y1 = 100;

# 対角線の向かいの点P3
my $x3 = 300;
my $y3 = 300;

# 四角形を描画
$gfx-&gt;rectxy($x1, $y1, $x3, $y3);

# 線の色を、黒より少し薄い色に
$gfx-&gt;strokecolor('#333');

# 背景色をとても薄いグレーに
$gfx-&gt;fillcolor('#eee');

# 四角形を塗りつぶして線を描画
$gfx-&gt;fillstroke;

my $pdf_file = 'basic_rect.pdf';
$pdf-&gt;saveas($pdf_file);
</pre>
<p>
  そのまま実行できる四角形を描画できるサンプルです。
</p>
<h3>その他の基本図形を書く</h3>
<p>
  その他の基本図形を書きたい場合に、どのメソッドを使うのかを紹介しておきます。
</p>
<h4>円を書く</h4>
<p>
  円を書く場合は、circleメソッドを使用します。リストの箇条書きの●などに利用できます。
</p>
<h4>楕円を書く</h4>
<p>
  楕円を書く場合は、ellipseメソッドを使用します。
</p>
<h4>扇形を書く</h4>
<p>
  扇形を書きたい場合は、pieメソッドを使用します。
</p>
<h4>円弧を書く</h4>
<p>
  円弧を書く場合は、arcあるいはbogenメソッドを使用します。bogenメソッドは、円弧の始点と終点を指定できるので、角丸などに利用できます。
</p>
<h4>楕円の円弧を書く</h4>
<p>
  楕円の円弧を書く場合は、bogenメソッドを使用します。
</p>
<h4>曲線(ペジェ曲線)を書く</h4>
<p>
  曲線(ペジェ曲線)を書くには、curveメソッドを使用します。ペジェ曲線のアルゴリズムによる曲線が書けます。
</p>
<h4>曲線(スプライン曲線)を書く</h4>
<p>
  曲線(スプライン曲線)を書くには、splineメソッドを使用します。点を滑らかにつなげた曲線が書けます。
</p>
<h4>多角形を描画する</h4>
<p>
  多角形を描画するには、polyメソッドを使用します。三角形や、五角形や六角形などを描画できます。
</p>
<h4>図形を回転させる</h4>
<p>
  図形を回転させるには、rotateメソッドを使用します。
</p>
<h4>図形を拡大・縮小する</h4>
<p>
  図形を拡大・縮小させるには、scaleメソッドを使用します。
</p>
<h3>表を作成する</h3>
<p>
  では、表を作成してみましょう。
</p>
<p>
  表の考え方は、まず一番外側に、枠があります。それぞれの項目に対しても枠があります。項目の枠と外枠を重ねることができれば、表の完成です。四角形を組み合わせて、外側を重ねることで、描画できそうです。
</p>
<p>
  でも、この方法問題点が発覚しました。同じに位置に二回描画すると、線が濃くなってしまうのです。
</p>
<p>
  ですので、縦と横に線を引くというシンプルな方法で、表を作成してみます。
</p>
<pre>
use PDF::API2;

# PDFオブジェクトの生成
my $pdf = PDF::API2-&gt;new;

# 用紙サイズのデフォルトのグローバル設定(用紙サイズを取得するため)
$pdf-&gt;mediabox(undef);

# ページの高さと幅
my @page_size_infos = $pdf-&gt;mediabox;
my $page_width = $page_size_infos[2];
my $page_height = $page_size_infos[3];

# 項目の高さ
my $item_height = 25;

# 行の数
my $rows_count = 20;

# 各項目の幅
my $name_width = 230;
my $unit_price_width = 80;
my $count_width = 80;
my $price_width = 80;
my $table_width = $name_width + $unit_price_width + $count_width + $price_width;

# テーブルの高さ
my $table_height = $item_height * $rows_count;

# テーブルの始点

# 表の外枠
my $table_start_x = 50;
my $table_start_y = $page_height - 50;
my $table_other_side_x = $table_start_x + $table_width;
my $table_other_side_y = $table_start_y - $table_height;

# ページの作成
my $page = $pdf-&gt;page;

# グラフィック用のコンテンツオブジェクトの生成
my $gfx = $page-&gt;gfx;

# 上の線を引く
$gfx-&gt;move($table_start_x, $table_start_y);
$gfx-&gt;line($table_start_x + $table_width, $table_start_y);

# 左の線を引く
$gfx-&gt;move($table_start_x, $table_start_y);
$gfx-&gt;line($table_start_x, $table_start_y - $table_height);

my $cur_x = $table_start_x;
my $cur_y = $table_start_y;

# 各項目の枠の描画
for (my $column = 0; $column &lt; $rows_count; $column++) {
  
  # 名前の枠(右と下)
  $gfx-&gt;move($cur_x + $name_width, $cur_y);
  $gfx-&gt;line($cur_x + $name_width, $cur_y - $item_height);
  $gfx-&gt;move($cur_x, $cur_y - $item_height);
  $gfx-&gt;line($cur_x + $name_width, $cur_y - $item_height);
  $cur_x += $name_width;

  # 単価の枠(右と下)
  $gfx-&gt;move($cur_x + $unit_price_width, $cur_y);
  $gfx-&gt;line($cur_x + $unit_price_width, $cur_y - $item_height);
  $gfx-&gt;move($cur_x, $cur_y - $item_height);
  $gfx-&gt;line($cur_x + $unit_price_width, $cur_y - $item_height);
  $cur_x += $unit_price_width;

  # 数量の枠(右と下)
  $gfx-&gt;move($cur_x + $count_width, $cur_y);
  $gfx-&gt;line($cur_x + $count_width, $cur_y - $item_height);
  $gfx-&gt;move($cur_x, $cur_y - $item_height);
  $gfx-&gt;line($cur_x + $count_width, $cur_y - $item_height);
  $cur_x += $count_width;

  # 価格の枠(右と下)
  $gfx-&gt;move($cur_x + $price_width, $cur_y);
  $gfx-&gt;line($cur_x + $price_width, $cur_y - $item_height);
  $gfx-&gt;move($cur_x, $cur_y - $item_height);
  $gfx-&gt;line($cur_x + $price_width, $cur_y - $item_height);
  $cur_x += $price_width;
  
  # 次の行へ
  $cur_x = $table_start_x;
  $cur_y -= $item_height;
}

# 線の色を、黒より少し薄い色に
$gfx-&gt;strokecolor('#333');

# 四角形を塗りつぶして線を描画
$gfx-&gt;stroke;

my $pdf_file = 'table.pdf';
$pdf-&gt;saveas($pdf_file);
</pre>
<p>
  情報が何も入っていない表が完成しました。
</p>
<h4>見出しと項目が入った表のサンプル</h4>
<p>
  最後に、見出しと項目が入った表のサンプルを作成してみましょう。
</p>
<p>
  PDFに以下の表が書き出されます。
</p>
<table>
  <tr><th>Name</th><th>Unit</th><th>Count</th><th>Price</th></tr>
  <tr><td>Book1</td><td>1000</td><td>3</td><td>3000</td></tr>
  <tr><td>Book2</td><td>2000</td><td>6</td><td>12000</td></tr>
  <tr><td>Book3</td><td>1500</td><td>5</td><td>7500</td></tr>
</table>
<div style="margin-bottom:10px"></div>
<pre>
use strict;
use warnings;
use utf8;

use PDF::API2;

# PDFオブジェクトの生成
my $pdf = PDF::API2-&gt;new;

# 用紙サイズのデフォルトのグローバル設定(用紙サイズを取得するため)
$pdf-&gt;mediabox(undef);

# ページの高さと幅
my @page_size_infos = $pdf-&gt;mediabox;
my $page_width = $page_size_infos[2];
my $page_height = $page_size_infos[3];

# 項目の高さ
my $item_height = 25;

# 行の数
my $rows_count = 20;

# 各項目の幅
my $name_width = 230;
my $unit_price_width = 80;
my $count_width = 80;
my $price_width = 80;
my $table_width = $name_width + $unit_price_width + $count_width + $price_width;

# テーブルの高さ
my $table_height = $item_height * $rows_count;

# テーブルの始点

# 表の外枠
my $table_start_x = 50;
my $table_start_y = $page_height - 50;
my $table_other_side_x = $table_start_x + $table_width;
my $table_other_side_y = $table_start_y - $table_height;

# ページの作成
my $page = $pdf-&gt;page;

# グラフィック用のコンテンツオブジェクトの生成
my $gfx = $page-&gt;gfx;

# テキスト用のコンテンツオブジェクトの生成
my $text = $page-&gt;text;
my $font = $pdf-&gt;corefont('Helvetica');
my $font_bold = $pdf-&gt;corefont('Helvetica-Bold');
my $font_size = 11;
$text-&gt;font($font, $font_size);
my $text_height = $font_size;

my $books = [
  {
    name =&gt; 'Book1',
    unit_price =&gt; 1000,
    count =&gt; 3,
  },
  {
    name =&gt; 'Book2',
    unit_price =&gt; 2000,
    count =&gt; 6,
  },
  {
    name =&gt; 'Book3',
    unit_price =&gt; 1500,
    count =&gt; 5,
  }
];
my $books_length = @$books;

# 上の線を引く
$gfx-&gt;move($table_start_x, $table_start_y);
$gfx-&gt;line($table_start_x + $table_width, $table_start_y);

# 左の線を引く
$gfx-&gt;move($table_start_x, $table_start_y);
$gfx-&gt;line($table_start_x, $table_start_y - $table_height);

my $cur_x = $table_start_x;
my $cur_y = $table_start_y;

my $item_padding_top = 17;
my $item_padding_left = 5;

# 各項目の枠の描画
for (my $column = 0; $column &lt; $rows_count; $column++) {
  
  my $book_index = $column - 1;
  
  # 名前の枠(右と下)
  # 見出し
  $text-&gt;translate($cur_x + $item_padding_left, $cur_y - $item_padding_top);
  if ($column == 0) {
    $text-&gt;font($font_bold, $font_size);
    $text-&gt;text('Name');
  }
  # 項目
  else {
    $text-&gt;font($font, $font_size);
    if ($book_index &lt; $books_length) {
      $text-&gt;text($books-&gt;[$book_index]{name});
    }
  }
  $gfx-&gt;move($cur_x + $name_width, $cur_y);
  $gfx-&gt;line($cur_x + $name_width, $cur_y - $item_height);
  $gfx-&gt;move($cur_x, $cur_y - $item_height);
  $gfx-&gt;line($cur_x + $name_width, $cur_y - $item_height);
  $cur_x += $name_width;

  # 単価の枠(右と下)
  $text-&gt;translate($cur_x + $item_padding_left, $cur_y - $item_padding_top);
  if ($column == 0) {
    $text-&gt;font($font_bold, $font_size);
    $text-&gt;text('Unit');
  }
  # 項目
  else {
    $text-&gt;font($font, $font_size);
    if ($book_index &lt; $books_length) {
      $text-&gt;text($books-&gt;[$book_index]{unit_price});
    }
  }
  $gfx-&gt;move($cur_x + $unit_price_width, $cur_y);
  $gfx-&gt;line($cur_x + $unit_price_width, $cur_y - $item_height);
  $gfx-&gt;move($cur_x, $cur_y - $item_height);
  $gfx-&gt;line($cur_x + $unit_price_width, $cur_y - $item_height);
  $cur_x += $unit_price_width;

  # 数量の枠(右と下)
  # 見出し
  $text-&gt;translate($cur_x + $item_padding_left, $cur_y - $item_padding_top);
  if ($column == 0) {
    $text-&gt;font($font_bold, $font_size);
    $text-&gt;text('Count');
  }
  # 項目
  else {
    $text-&gt;font($font, $font_size);
    if ($book_index &lt; $books_length) {
      $text-&gt;text($books-&gt;[$book_index]{count});
    }
  }
  $gfx-&gt;move($cur_x + $count_width, $cur_y);
  $gfx-&gt;line($cur_x + $count_width, $cur_y - $item_height);
  $gfx-&gt;move($cur_x, $cur_y - $item_height);
  $gfx-&gt;line($cur_x + $count_width, $cur_y - $item_height);
  $cur_x += $count_width;

  # 価格の枠(右と下)
  # 見出し
  $text-&gt;translate($cur_x + $item_padding_left, $cur_y - $item_padding_top);
  if ($column == 0) {
    $text-&gt;font($font_bold, $font_size);
    $text-&gt;text('Pirce');
  }
  # 項目
  else {
    $text-&gt;font($font, $font_size);
    if ($book_index &lt; $books_length) {
      $text-&gt;text($books-&gt;[$book_index]{unit_price} * $books-&gt;[$book_index]{count});
    }
  }
  $gfx-&gt;move($cur_x + $price_width, $cur_y);
  $gfx-&gt;line($cur_x + $price_width, $cur_y - $item_height);
  $gfx-&gt;move($cur_x, $cur_y - $item_height);
  $gfx-&gt;line($cur_x + $price_width, $cur_y - $item_height);
  $cur_x += $price_width;
  
  # 次の行へ
  $cur_x = $table_start_x;
  $cur_y -= $item_height;
}

# 線の色を、黒より少し薄い色に
$gfx-&gt;strokecolor('#333');

# 四角形を塗りつぶして線を描画
$gfx-&gt;stroke;
</pre>

<div style="font-weight:bold;font-size:18px;letter-spacing:2px;margin:35px 0 0px 0;padding-left:5px;padding-top:5px;border-top:2px solid #ddd">2019/12/31</div>
<ol class="bread" itemscope itemtype="http://schema.org/BreadcrumbList">
  <li itemprop="itemListElement" itemscope itemtype="http://schema.org/ListItem">
    <a itemprop="item" href="/">
        <span itemprop="name">Perl</span></a>
    <meta itemprop="position" content="1" />
  </li>
  &#8250;
  <li itemprop="itemListElement" itemscope itemtype="http://schema.org/ListItem">
    <a itemprop="item" href="/blog/20191228171433.html">
      <span itemprop="name">帳票作成</span></a>
    <meta itemprop="position" content="2" />
  </li>
  &#8250;
  <li>
    here
  </li>
</ol>
<h2><a href="/blog/20191231143440.html">画像を挿入する - PDF::API2で帳票作成</a></h2>
<p>
  PDF::API2で、PNG,GIF,JPEGの画像を挿入する方法を解説します。
</p>
<p>
  PDFには、画像を含めることができます。PDF::API2では、PNG,GIF,JPEG画像を、PDFに挿入することができます。
</p>
<h3>画像ファイルの挿入</h3>
<p>
  画像ファイルを挿入するには、まず画像ファイルを読み込んで、画像表現するリソースオブジェクトを生成する必要があります。
</p>
<h4>画像ファイルの読み込み</h4>
<p>
  画像ファイルを読み込んで、画像表現するリソースオブジェクトを生成しましょう。
</p>
<p>
  <b>JPEGファイルの読み込み</b>
</p>
<p>
  PDF::API2で、JPEGファイルを読み込むには、image_jpegメソッドを使用します。JPEG画像を表現するリソースオブジェクトが返されます。
</p>
<pre>
# JPEG画像を表現するリソースオブジェクトを生成
my $image_file = '/path/image.jpeg';
my $image_object = $pdf-&gt;image_jpeg($image_file);
</pre>
<p>
  <b>PNGファイルの読み込み</b>
</p>
<p>
  PDF::API2で、PNGファイルを読み込むには、image_pngメソッドを使用します。PNG画像を表現するリソースオブジェクトが返されます。
</p>
<pre>
# PNG画像を表現するリソースオブジェクトを生成
my $image_file = '/path/image.png';
my $image_object = $pdf-&gt;image_png($image_file)
</pre>
<p>
  <b>GIFファイルの読み込み</b>
</p>
<p>
  PDF::API2で、GIFファイルを読み込むには、image_gifメソッドを使用します。GIF画像を表現するリソースオブジェクトが返されます。
</p>
<pre>
# GIF画像を表現するリソースオブジェクトを生成
my $image_file = '/path/image.gif';
my $image_object = $pdf-&gt;image_gif($image_file)
</pre>
<h4>画像コンテンツオブジェクトの生成</h4>
<p>
  画像を挿入するための、コンテンツオブジェクトを生成します。これはPDF::API2::Contentオブジェクトです。
</p>
<pre>
# 画像を挿入するために必要なコンテンツオブジェクト
my $gfx = $page-&gt;gfx;
</pre>
<h4>画像ファイルの挿入</h4>
<p>
  PDF::API2で、画像ファイルを挿入するには、コンテンツオブジェクトのimageメソッドを使用します。
</p>
<pre>
# 指定した位置に画像を挿入
$gfx-&gt;image($image_object, $x, $y);

# 指定した位置に画像挿入。幅と高さを指定
$gfx-&gt;image($image_object, $x, $y, $width, $height);

# 指定した位置に画像挿入。スケールを指定(1.5倍など)
$gfx-&gt;image($image_object, $x, $y, $scale);
</pre>
<p>
  指定した位置に画像が挿入されます。
</p>
<p>
  幅と高さは、PDF単位であることに注意してください。
</p>
<p>
  例として、600x600のイメージを600dpiの解像度で表示したい場合は、72を指定します。
</p>

<div style="font-weight:bold;font-size:18px;letter-spacing:2px;margin:35px 0 0px 0;padding-left:5px;padding-top:5px;border-top:2px solid #ddd">2019/12/30</div>
<ol class="bread" itemscope itemtype="http://schema.org/BreadcrumbList">
  <li itemprop="itemListElement" itemscope itemtype="http://schema.org/ListItem">
    <a itemprop="item" href="/">
        <span itemprop="name">Perl</span></a>
    <meta itemprop="position" content="1" />
  </li>
  &#8250;
  <li itemprop="itemListElement" itemscope itemtype="http://schema.org/ListItem">
    <a itemprop="item" href="/blog/20191228171433.html">
      <span itemprop="name">帳票作成</span></a>
    <meta itemprop="position" content="2" />
  </li>
  &#8250;
  <li>
    here
  </li>
</ol>
<h2><a href="/blog/20191230091936.html">テキストを描画する  - PDF::API2で帳票作成</a></h2>
<p>
  PDF::API2で、PDFにテキストを描画するには、次のようにします。
</p>
<pre>
use PDF::API2;

my $pdf = PDF::API2-&gt;new;

my $page = $pdf-&gt;page;

# コアフォントの読み込み
my $font = $pdf-&gt;corefont('Helvetica-Bold');

# テキストを表現するコンテンツオブジェクトを取得
my $text = $page-&gt;text();

# フォントを設定
$text-&gt;font($font, 11);

# 描画位置を設定(原点は、左下。デフォルトでは、ページの幅が612単位、高さが792単位)
$text-&gt;translate(30, 750);

# テキストを描画
$text-&gt;text('Hello World!');

my $pdf_file = 'text_core_font.pdf';
$pdf-&gt;saveas($pdf_file);
</pre>
<p>
  <b>フォントオブジェクトの取得</b>
</p>
<p>
  PDF::API2では、フォントを表現するフォントオブジェクトをcorefontメソッドあるいはttfontメソッドを使って取得します。ここでは、corefontオブジェクトを使って描画しています。
</p>
<pre>
# コアフォントの読み込み
my $font = $pdf-&gt;corefont('Helvetica-Bold');
</pre>
<p>
  コアフォントを取得するにはcorefontメソッドを使います。注意点としては、corefontでは、日本語が描画できないことに注意してください。日本語を利用したい場合は、ttfontで日本語をサポートするトゥルータイプフォントを、指定する必要があります。
</p>
<p>
  <b>テキストを表現するコンテンツオブジェクト</b>
</p>
<p>
  PDF::API2では、テキストを表現するコンテンツオブジェクトをページオブジェクトのtextメソッドを使って取得します。ここでは、テキストを表現するコンテンツオブジェクトをテキストオブジェクトと呼びます。これはPDF::API2::Contentオブジェクトです。
</p>
<pre>
# テキストを表現するコンテンツオブジェクトを取得
my $text = $page-&gt;text();
</pre>
<p>
  <b>フォントの設定</b>
</p>
<p>
  PDF::API2では、テキストオブジェクトのfontメソッドで、フォントを設定します。
</p>
<pre>
# フォントを設定
$text-&gt;font($font, 11);
</pre>
<p>
  <b>描画位置の指定</b>
</p>
<p>
  PDF::API2では、テキストオブジェクトのtranslateメソッドで描画位置を設定します。
</p>
<pre>
# 描画位置を設定(原点は、左下。デフォルトでは、ページの幅が612単位、高さが792単位)
$text-&gt;translate(30, 750);
</pre>
<p>
  原点は、左下。デフォルトでは、ページの幅が612単位、高さが792単位です。PDF座標については、<a href="/blog/20191226175520.html">PDFファイルを作成する</a>の「用紙サイズを設定する」の解説を見てください。
</p>
<p>
  注意点としては、ページの余白やテキストの行数などの設定などはできず、描画位置は、translateメソッドで指定する必要があることです。描画位置を自分で計算して指定する必要があることに注意してください。
</p>
<p>
  <b>テキストの描画</b>
</p>
<p>
  PDF::API2では、テキストオブジェクトのtextメソッドでテキストを描画します。
</p>
<pre>
# テキストを描画
$text-&gt;text('Hello World!');
</pre>
<p>
  テキストを描画すると、現在の描画位置のx座標がテキストの終端まで移動します。この位置は、textposメソッドで取得できます。
</p>
<h3>アンダーラインを描画</h3>
<p>
  PDF::API2でテキストにアンダーラインを描画するにはtextメソッドの「-underline」オプションを指定します。「auto」で自動的にアンダーラインの位置が決まります。
</p>
<pre>
# アンダーラインを描画
$text-&gt;text('Hello World!', -underline =&gt; 'auto');
</pre>
<h3>テキストを指定位置を中心として描画</h3>
<p>
  PDF::API2でテキストを指定位置を中心として描画するには、text_centerメソッドを使用します。オプションは、textメソッドと同一です。
</p>
<pre>
# アンダーラインを描画
$text-&gt;text_center('Hello World!');
</pre>
<p>
  ページの見出しなどを画面の中央に表示したい場合などに利用できます。
</p>
<h3>テキストを指定位置を右端として描画</h3>
<p>
  PDF::API2でテキストを指定位置を右端として描画として描画するには、text_rightメソッドを使用します。オプションは、textメソッドと同一です。
</p>
<p>
  ページ番号などの、右下に表示したい場合などに利用できます。
</p>
<pre>
# アンダーラインを描画
$text-&gt;text_right('Hello World!');
</pre>
<h3>現在のテキストの描画位置を取得する</h3>
<p>
  PDF::API2で現在のテキストの描画位置を取得するには、textposメソッドを使用します。
</p>
<pre>
# 現在のテキストの描画位置を取得
my ($x, $y) = $text-&gt;textpos();
</pre>
<p>
  この値を使って、改行すべき位置をチェックしたり、改ページすべき位置をチェックすることができます。
</p>
<h3>フォントサイズを取得する</h3>
<p>
  PDF::API2で、既存のテキストのフォントサイズを取得するには、textstateメソッドを引数なしで呼び出し、テキストの状態を表現するハッシュが返されるので、fontsizeの値を取り出します。
</p>
<pre>
# 既存のテキストのフォントサイズを取得
my %text_state = $text-&gt;textstate;
my $font_size = $text_state{fontsize};
</pre>
<h3>テキストの高さを取得する</h3>
<p>
  テキストの高さは、実は、フォントサイズと同じです。フォントサイズ16は、PDF単位の16と同じです。改行をする場合は、フォントサイズで改行すれば、重なることがありません。
</p>
<pre>
my $font_size = 16;
my $text_height = $font_size;
</pre>
<h3>行の高さ</h3>
<p>
  行と行の間は行間が少し空いていますね。行の高さは、テキストの高さに、行間の幅を加えたものになります。フォントサイズ(テキストの高さ)が11で、行間が2だとすると、行の高さは、13となります。
</p>
<pre>
# フォントサイズ(テキストの高さ)
my $font_size = 16;
my $text_height = $font_size;

# 行間
my $line_margin = 2;

# 行の高さ
my $line_height = $text_height + $line_margin;
</pre>
<p>
  例えば、改行をして、移動するときは、行の高さを減算してあげればよいです。
</p>
<h3>描画するテキストの幅を取得</h3>
<p>
  描画するテキストの幅をあらかじめ取得するにはadvancewidthメソッドを使用します。
</p>
<pre>
my $text_width = $text-&gt;advancewidth($string);
</pre>
<p>
  右側にはみ出した場合に改行という処理を行う場合に、利用できます。
</p>
<h3>余白の設定</h3>
<p>
  PDF::API2を使う場合は、ページに余白を設定したい場合は、GUIでの画面のように、余白の値を設定することはできません。自分で計算する必要があります。
</p>
<p>
  ただしデメリットばかりではなく、この方法を覚えておくと、奇数ページと偶数ページで、余白を変えたりと、非常に柔軟性があります。
</p>
<h4>PDF単位とインチとmmの関係</h4>
<p>
  まず最初にPDFで指定されるPDF単位とインチとmmの関係を覚えましょう。
</p>
<p>
  PDFの1単位は、1/72インチです。
</p>
<p>
  1インチは、25.4mmです。
</p>
<p>
  PDFの1単位は、mmに換算すると約0.352777777777778mmです。割り切れません。
</p>
<p>
  PDFの3単位は、mmに換算すると約1.05833333333333mmです。割り切れません。
</p>
<p>
  PDFの9単位は、mmに換算すると、3.175mmです。
</p>
<p>
  PDFの3単位が1mmに近いですね。9単位がきりが良いです。
</p>
<p>
  余白をだいたい12mm～13mmにしたいとすれば、PDF単位の36を使います。考え方としては、PDFの9単位は、mmに換算すると、3.175mmですから、これに4をかけると、36単位で、12.7mmとなります。
</p>
<p>
  ここでの解説は、上下左右のすべての余白が36単位であるとします。
</p>
<pre>
# ページ上余白
my $page_top_margin = 36;

# ページ下余白
my $page_bottom_margin = 36;

# ページ左余白
my $page_left_margin = 36;

# ページ右余白
my $page_right_margin = 36;
</pre>
<p>
  上下余白については、フォントのベースラインが基準になりますので、見た目よりも、すこし文字がはみ出ることに注意してください。
</p>
<h4>描画開始位置と描画終了位置</h4>
<p>
  余白を考える場合は、描画の開始位置のXY座標と、描画終了位置のXY座標を計算で求める必要があります。
</p>
<p>
  まず、用紙サイズの幅を取得しましょう。(参考:<a href="/blog/20191226175520.html">PDFファイルを作成する</a>の用紙サイズを取得する)
</p>
<pre>
# 用紙サイズの幅と高さを取得
my @page_size_infos = $page-&gt;mediabox;
my $page_width = $page_size_infos[2];
my $page_height = $page_size_infos[3];
</pre>
<p>
  PDFの座標は、左下から始まるということを、意識しておきましょう。これが、典型的なPDFドキュメントとすると、ページの幅が、612単位、高さが792単位ですので、ページの左上の座標は(0, 791)です。(0, 0)ではないので注意してください。
</p>
<p>
  x座標は、そのまま計算できますが、y座標は、ページの高さから減算して求める必要があります。
</p>
<p>
  描画開始位置のxy座標と、描画終了位置のxy座標を計算して求めると次のようになります。
</p>
<pre>
# 描画開始x座標
my $render_start_x = 0;

# 描画開始y座標
my $render_start_y = $page_height - 1;

# 描画終了x座標
my $render_end_x = $page_width - 1;

# 描画終了y座標 = 0;
my $render_end_y = 0;
</pre>
<p>
  これに余白を追加すると以下のようになります。
</p>
<pre>
# 描画開始x座標
my $render_start_x = $page_left_margin;

# 描画開始y座標
my $render_start_y = $page_height - 1 - $page_top_margin;

# 描画終了x座標
my $render_end_x = $page_width - 1 - $page_right_margin;

# 描画終了y座標
my $render_end_y = $page_bottom_margin;
</pre>
<h4>余白、改行、改ページに対応したテキストの描画</h4>
<p>
  では、ここで余白、改行、改ページを意識して、テキストを、描画してみましょう。右端に到達すると改行します。英語のみです。英単語は、1文字づつの単位で改行されます。下に到達すると改ページします。
</p>
<pre>
use strict;
use warnings;
use utf8;

use PDF::API2;

my $pdf = PDF::API2-&gt;new;

# コアフォントの読み込み
my $font = $pdf-&gt;corefont('Helvetica-Bold');
my $font_size = 11;

# テキストの高さ
my $text_height = $font_size;

# 行間
my $line_margin = 2;

# 行の高さ
my $line_height = $text_height + $line_margin;

# 用紙サイズのデフォルトのグローバル設定(用紙サイズを取得するため)
$pdf-&gt;mediabox(undef);

# ページの高さと幅
my @page_size_infos = $pdf-&gt;mediabox;
my $page_width = $page_size_infos[2];
my $page_height = $page_size_infos[3];

# ページ余白
my $page_top_margin = 36;
my $page_bottom_margin = 36;
my $page_left_margin = 36;
my $page_right_margin = 36;

# 描画開始x座標
my $render_start_x = $page_left_margin;

# 描画開始y座標
my $render_start_y = $page_height - 1 - $page_top_margin;

# 描画終了x座標
my $render_end_x = $page_width - 1 - $page_right_margin;

# 描画終了y座標
my $render_end_y = $page_bottom_margin;

# メッセージ(1000回の同じメッセージ繰り返し)
my $message = 'Hello World!' x 1000;

# 改行戻りx座標を保存
my $new_line_left_x = $render_start_x;

# 現在描画位置
my $cur_render_x = $render_start_x;
my $cur_render_y = $render_start_y;

# ページの作成
my $page = $pdf-&gt;page;

# テキストを表現するコンテンツオブジェクトを取得
my $text = $page-&gt;text();

# フォント設定
$text-&gt;font($font, $font_size);

# 描画開始位置に移動
$text-&gt;translate($render_start_x, $render_start_y);

# 1文字づつ取り出し
while ($message =~ /(.)/g) {
  my $char = $1;
  
  # 現在描画位置が、描画終了x座標を超えていれば改行
  if ($cur_render_x &gt; $render_end_x) {
    $cur_render_x = $new_line_left_x;
    $cur_render_y -= $line_height;
    
    # 描画開始位置に移動
    $text-&gt;translate($cur_render_x, $cur_render_y);
  }

  # 現在描画位置が、描画終了y座標を超えていれば改ページ
  if ($cur_render_y &lt; $render_end_y) {
    $cur_render_x = $render_start_x;
    $cur_render_y = $render_start_y;
    
    # ページの作成
    $page = $pdf-&gt;page;

    # テキストを表現するコンテンツオブジェクトを取得
    $text = $page-&gt;text();

    # フォント設定
    $text-&gt;font($font, $font_size);

    # 描画開始位置に移動
    $text-&gt;translate($cur_render_x, $cur_render_y);
  }
  
  # 文字を描画
  $text-&gt;text($char);
  
  # 描画位置を更新
  ($cur_render_x) = $text-&gt;textpos;
}

my $pdf_file = 'margin_full_text.pdf';
$pdf-&gt;saveas($pdf_file);
</pre>
<p>
  「Hello World!」が繰り返される、余白つきページが、3ページ出力されます。
</p>
<p>
  僕の環境では、1万2000文字で1～2秒かかっています。PDF出力は、意外に重い処理です。
</p>
<h4>HTMLの見出しやpタグを表現するには?</h4>
<p>
  ここでは、詳しく解説しませんが、ヒントだけ書いておきます。少なくとも、タグを解析する必要があります。正規表現や、HTMLを解析してくれるモジュールが利用できるでしょう。後で、リストやテーブルに対応することを考えると、HTMLを解析してくれるモジュールを使うのが、汎用的でしょうか。
</p>
<pre>
&lt;h1&gt;タイトル&lt;/h1&gt;

&lt;p&gt;
メッセージ
&lt;/p&gt;
</pre>
<p>
  XML::Simpleの利用が、簡単そうです。固定書式であれば、難しいことを考えることがないので、XML::Simpleで、Perlの多次元データ構造にできれば、よさそうな感じはします。
</p>
<p>
  本を作るときのような、固定書式で出力するのであれば、CSSの解析はいらなさそうです。見出しやpタグごとの、マージンの設定をプログラム上で行う必要がありそうですね。
</p>
<h4>英単語の単位で改行するには?</h4>
<p>
  英単語を改行の途中で切りたくないというのは、よくありそうですね。この場合は、少し難しいですが、次のように考えましょう。
</p>
<p>
  まず、英文字が始まるx座標を覚えておきます。また、英文字が始まった場合に、これを、$tmp_wordのような文字列に保存しておきましょう。テキスト出力はまだ待って、次のループに移動しましょう。英文字以外が来た場合に、その直前までが、一つの英単語です。もし、$tmp_wordの幅が、右端を超えていたら、改行して出力、超えていなかったら、そのまま出力です。
</p>
<h3>日本語を描画するためのフォント</h3>
<p>
  PDF::API2で日本語を描画するためには、日本語に対応したフォントが必要になります。コアフォントは、英語だけです。
</p>
<p>
  フォントの中でも、TrueType Font(トゥルータイプフォント)と呼ばれるフォントを使う必要があります。
</p>
<p>
  フォントは、一つのファイルとして提供されていて、TrueType Fontの拡張子は、ttfです。
</p>
<h4>TrueType Fontの取得</h4>
<p>
  無料で利用できるTrueTypeフォントがあるので、それを取得しましょう。検索するとたくさんでてきます。
</p>
<p>
  選択の注意点としては、オープンフォントではなく、トゥルータイプフォントを選ぶことと、PDFに埋め込み可能なフォントを選ぶことです。
</p>
<p>
  トゥルータイプフォントファイルは、ポータブルなので、機種依存文字を使わない限りは、WindowsでもMacでもLinuxでも同じように扱えます。OSへのフォントのインストール方法に違いがありますが、ファイルを直接読み込む場合は、関係ありません。(参考:<a href="https://fontnavi.jp/zakkuri/105-font_for_mac_win.aspx">Windows用フォントとMac用フォントは違うのか</a>)
</p>
<p>
  ここでは、日本語を描画できるTrueTypeフォントの中で、kochi-gothic-subst.ttfというものを一つ紹介しておきます。
</p>
<ul>
  <li><a href="https://github.com/indico/indico-fonts/raw/master/indico_fonts/kochi-gothic-subst.ttf">kochi-gothic-subst.ttf</a>(<a href="https://github.com/indico/indico-fonts/tree/master/indico_fonts">フォント一覧ページ</a>)
</ul>
<p>
  ダウンロードして、好きな場所に配置してください。
</p>
<h4>TrueType Fontの読み込み</h4>
<p>
  TrueType Fontは、ttfontメソッドで読み込むことができます。取得したTrueType Fontのパスを指定します。
</p>
<pre>
my $true_type_font_file = '/path/kochi-gothic-subst.ttf';
my $font = $pdf-&gt;ttfont($true_type_font_file);
</pre>
<p>
  corefontでコアフォントを読み込んでいる場所を、上記に書き換えると、日本語を出力できます。
</p>
<p>
  Perlの日本語を扱う場合のお約束として、ファイルはUTF-8で保存して、use utf8を行ってください。
</p>
<pre>
use utf8;
</pre>
<p>
  PDF::API2においては、フォントは、PDFファイルに埋め込まれ、PDFファイルは、フォントファイルを参照しません。
</p>
<p>
  プログラムのおいたディレクトリにフォントファイルを置いて、読み込む場合は、FindBinモジュールを使って、次のようにするのが簡単です。
</p>
<pre>
use FindBin;

my $true_type_font_file = "$FindBin::Bin/kochi-gothic-subst.ttf";
</pre>

<div style="font-weight:bold;font-size:18px;letter-spacing:2px;margin:35px 0 0px 0;padding-left:5px;padding-top:5px;border-top:2px solid #ddd">2019/12/28</div>
<ol class="bread" itemscope itemtype="http://schema.org/BreadcrumbList">
  <li itemprop="itemListElement" itemscope itemtype="http://schema.org/ListItem">
    <a itemprop="item" href="/">
        <span itemprop="name">Perl</span></a>
    <meta itemprop="position" content="1" />
  </li>
  &#8250;
  <li itemprop="itemListElement" itemscope itemtype="http://schema.org/ListItem">
    here
  </li>
</ol>
<h2><a href="/blog/20191228171433.html">Perlで帳票を作成する - PDF::API2で帳票作成</a></h2>
<p>
  Perlで帳票を作成する方法を解説します。ここでは、帳票とは、プリンタを使って、紙に印刷可能なファイル形式と定義します。
</p>
<p>
  帳票を作るための一般的な方法は、PDFを作成することです。PDFであれば、印刷することができます。
</p>
<p>
  <a href="https://metacpan.org/pod/PDF::API2">PDF::API2</a>というPerlのモジュールを使うと、PDFを作成したり、フォントを設定して字を書いたり、線を書いたり、画像を挿入したり、保存したりすることができます。
</p>
<p>
  PDF::API2の使い方をマスターすれば、自由に帳票を使えるようになります。
</p>
<h3>PDF::API2のインストール</h3>
<p>
  PDF::API2のインストール方法を解説します。
</p>
<ul>
  <li><a href="/blog/20191227161458.html">PDF::API2のインストール</a></li>
</ul>
<h3>帳票作成のためのPDFファイル操作</h3>
<p>
  PDFファイルの作成方法、テキストの描画、画像の挿入、基本図形と表の作成方法を学びましょう。
</p>
<ul>
  <li><a href="/blog/20191226175520.html">PDFファイルを作成する</a></li>
  <li><a href="/blog/20191230091936.html">テキストを描画する</a></li>
  <li><a href="/blog/20191231143440.html">画像を挿入する</a></li>
  <li><a href="/blog/20200101082734.html">基本図形の描画と表の作成</a></li>
</ul>

<div style="font-weight:bold;font-size:18px;letter-spacing:2px;margin:35px 0 0px 0;padding-left:5px;padding-top:5px;border-top:2px solid #ddd">2019/12/27</div>
<ol class="bread" itemscope itemtype="http://schema.org/BreadcrumbList">
  <li itemprop="itemListElement" itemscope itemtype="http://schema.org/ListItem">
    <a itemprop="item" href="/">
        <span itemprop="name">Perl</span></a>
    <meta itemprop="position" content="1" />
  </li>
  &#8250;
  <li itemprop="itemListElement" itemscope itemtype="http://schema.org/ListItem">
    <a itemprop="item" href="/blog/20191228171433.html">
      <span itemprop="name">帳票作成</span></a>
    <meta itemprop="position" content="2" />
  </li>
  &#8250;
  <li>
    here
  </li>
</ol>
<h2><a href="/blog/20191227161458.html">PDF::API2のインストール</a></h2>
<p>
  PDF::API2をインストールするには<a href="/blog/20100504127089.html">cpan</a>か<a href="/blog/20101027127859.html">cpanm</a>を使います。
</p>
<p>
  cpanmをインストールしている場合はcpanmを、そうでない場合は、cpanを使うのがお勧めです。
</p>
<pre>
# cpanmを使う場合
cpanm PDF::API2

# cpanを使う場合
cpan PDF::API2
</pre>

<div style="font-weight:bold;font-size:18px;letter-spacing:2px;margin:35px 0 0px 0;padding-left:5px;padding-top:5px;border-top:2px solid #ddd">2019/12/26</div>
<ol class="bread" itemscope itemtype="http://schema.org/BreadcrumbList">
  <li itemprop="itemListElement" itemscope itemtype="http://schema.org/ListItem">
    <a itemprop="item" href="/">
        <span itemprop="name">Perl</span></a>
    <meta itemprop="position" content="1" />
  </li>
  &#8250;
  <li itemprop="itemListElement" itemscope itemtype="http://schema.org/ListItem">
    <a itemprop="item" href="/blog/20191228171433.html">
      <span itemprop="name">帳票作成</span></a>
    <meta itemprop="position" content="2" />
  </li>
  &#8250;
  <li>
    here
  </li>
</ol>
<h2><a href="/blog/20191226175520.html">PDFファイルを作成する - PDF::API2で帳票作成</a></h2>
<p>
  PDF::API2で、PDFファイルを作成するには次のようにします。
</p>
<p>
  PDFの空の情報を作成するには、newメソッドを使用します。
</p>
<p>
  空のページを追加するには、pageメソッドを使います。
</p>
<p>
  最後にsaveasメソッドを使って、ファイルを保存します。
</p>
<p>
  この手順を行うことで、空の1ページが存在するPDFファイルを作成できます。
</p>
<pre>
use strict;
use warnings;

use PDF::API2;

# PDFの空の情報を作成
my $pdf = PDF::API2-&gt;new;

# 空のページを追加
my $page = $pdf-&gt;page;

# PDFをファイルに保存
my $pdf_file = 'empty.pdf';
$pdf-&gt;saveas($pdf_file);
</pre>
<p>
  空のPDFファイルが作成できれば、成功しています。
</p>
<h3>既存のPDFファイルを開く</h3>
<p>
  PDF::API2で既存のPDFファイルを開くには、openメソッドを使用します。
</p>
<pre>
# 既存のPDFファイルを開く
my $pdf = PDF::API2-&gt;open('some.pdf');
</pre>
<h3>新しいページを追加する</h3>
<p>
  PDF::API2で新しいページを追加するにはpageメソッドを使用します。pageで作成されたページは、PDFドキュメントの末尾に追加されます。
</p>
<pre>
# PDFドキュメントの末尾にページを追加
my $page = $pdf-&gt;page;
</pre>
<p>
  引数を指定すると、指定のページに挿入できます。既存のページは、後ろにずれます。
</p>
<pre>
# PDFドキュメントの指定のページにページを追加
my $page = $pdf-&gt;page(5);
</pre>
<h3>既存のページを取得する</h3>
<p>
  PDF::API2で既に存在しているページを取得するには、openpageメソッドで、ページ番号を指定します。ページ番号は、1から始まります。0からの始まりではないことに注意してください。
</p>
<pre>
# すでに存在しているページを取得
my $page = $pdf-&gt;openpage($page_number);
</pre>
<h3>ページ数を取得する</h3>
<p>
  PDF::API2で、存在しているページ数を取得するには、pagesメソッドを使用します。
</p>
<pre>
# PDFドキュメントのページ数を取得
my $pages_count = $pdf-&gt;pages;
</pre>
<h3>用紙サイズを設定する</h3>
<p>
  PDF::API2でページの用紙サイズを設定するには、mediaboxメソッドを使用します。
</p>
<pre>
# 名前で指定
$pdf-&gt;mediabox($name);

# 幅と高さで指定
$pdf-&gt;mediabox($width, $height)
</pre>
<p>
  指定できる名前はPDFで定義されている値です。以下に指定できる例を挙げておきます。これは、グローバルな設定であり、新規のページを作成した場合に、ページに設定が受け継がれます。
</p>
<p>
  各ページに用紙サイズを指定するには、ページオブジェクトのmediaboxメソッドを使用します。
</p>
<pre>
# 名前で指定
$page-&gt;mediabox($name);

# 幅と高さで指定
$page-&gt;mediabox($width, $height)
</pre>
<ul>
  <li>Letter</li>
  <li>A3</li>
  <li>A4</li>
  <li>B4</li>
  <li>A5</li>
  <li>B5</li>
  <li>A6</li>
  <li>B6</li>
</ul>
<p>
  PDF座標系についての簡単な解説のページのリンクを張っておきます。
</p>
<blockquote>
<p>
  幅と高さは、PDF単位という値で指定する必要があることに注意します。1単位は、1/72のインチ(約0.35mm)です。
</p>
<p>
  典型的なPDFドキュメントはページの幅が612単位、高さが792単位です。インチのサイズは、8.5"×11"です。幅と高さを72で割ることによって得られます。
</p>
<p>
  PDF文書が画面に与えられるとき、ピクセルなどの物理的な値が通常必要です。論理的にから物理的な単位まで変換するために、解像度は提供されなければなりません。解像度は、物理的な値に論理的な変換とき、使うインチにつき点（ピクセル）の値です。上記の例では、解像度として150を使用した場合、ピクセル単位のページサイズは1275×1650になります。これは8.5×11インチに150を乗算することによって得られます。
</p>
<p>
  (参考)<a target="_blank" href="http://docs.leadtools.grapecity.com/v19/dh/to/leadtools.topics.pdf~pdf.topics.pdfcoordinatesystem.html">PDF座標系</a>
</p>
</blockquote>
<p>
  PDF::API2で、用紙サイズを指定するサンプルです。
</p>
<pre>
use PDF::API2;

# A4サイズで指定
{
  my $pdf = PDF::API2-&gt;new();
  $pdf-&gt;mediabox('A4');
  my $mediabox = $pdf-&gt;mediabox;
  my $page = $pdf-&gt;page;
  my $pdf_file = 'size_a4.pdf';
  $pdf-&gt;saveas($pdf_file);
}

# B5サイズで指定
{
  my $pdf = PDF::API2-&gt;new();
  $pdf-&gt;mediabox('B5');
  my $page = $pdf-&gt;page;
  my $pdf_file = 'size_b5.pdf';
  $pdf-&gt;saveas($pdf_file);
}

# PDF単位 幅595,高さ842で指定
{
  my $pdf = PDF::API2-&gt;new();
  $pdf-&gt;mediabox(595, 842);
  my $page = $pdf-&gt;page;
  my $pdf_file = 'size_595_842.pdf';
  $pdf-&gt;saveas($pdf_file);
}
</pre>
<h3>用紙サイズを取得する</h3>
<p>
  用紙サイズを取得するには、引数を与えないで、ページオブジェクトのmediaboxメソッドを使用します。
</p>
<pre>
my @page_size_infos = $page-&gt;mediabox;
</pre>
<p>
  実際のページの用紙サイズの情報を取得するには、PDFオブジェクトではなく、ページオブジェクトのmediaboxメソッドを呼び出す必要があることに注意してください。
</p>
<p>
  用紙サイズの情報は、４つのPDF単位で取得されることに注意してください。
</p>
<pre>
(左下からのマージンX, 左下からのマージンY, 右上の座標X, 右上の座標Y)
</pre>
<p>
  たとえば、次のような値で、返ってきます。
</p>
<pre>
(0, 0, 612, 792)
</pre>
<p>
  一般的には、左下からのマージンXが0、 左下からのマージンYが0で返ってきますので、右上の座標Xが幅、右上の座標Yが、高さと考えてよいでしょう。
</p>

<div style="font-weight:bold;font-size:18px;letter-spacing:2px;margin:35px 0 0px 0;padding-left:5px;padding-top:5px;border-top:2px solid #ddd">2019/09/23</div>
<style>
  .top {
    display:none;
  }
</style>
<h2><a href="/blog/20190923084701.html">名古屋でのプログラミングPerlのイベント YAPC::Nagoya::Tiny 2019年11月3日(日)</a></h2>
<h3>YAPC::Nagoya::Tiny 2019年11月3日(日)</h3>
<p>
  PerlというプログラミングのイベントがYAPC::Nagoya::Tiny、名古屋で2019年11月3日(日)に開催されます。
</p>
<p>
  主催は、<a href="http://blog.yapcjapan.org/">YACP::Japan運営ブログ</a>を運営しているJAP(Japan Perl Association)です。
</p>
<p>
  今回の名古屋のYAPCの地方開催は初めてなので、まだ情報をチェックしていない方は、チェックしてみましょう。
</p>
<h3>YAPC::Japanが名古屋に初登場！ </h3>
<blockquote>
<p>
  <b>YAPC::Japanが名古屋に初登場！ </b>
</p>
<p>
  2016年から北海道、大阪、福岡、沖縄、東京で開催してきたYAPC::JapanがTinyとなって名古屋に登場です！
</p>
<p>
  YAPCはYet Another Perl Conferenceの略で草の根的に始まったPerlのカンファレンスです。私達YAPC::Japanは一般社団法人JPAが主催する、Perlを軸としたITに関わる全ての人のためのカンファレンスです。
</p>
<p>
  Perlだけにとどまらない多様な分野のトークセッションを通じ、情報交換や交流を行っていただくことで、JPAのミッションである「日本におけるPerlコミュニティを脈々と続くものとして」盛り上げていくことが目標です。
</p>
<p>
  ☆ 懇親会についても開催を予定しております。詳細が決まり次第、順次お知らせいたします。
</p>
<p>
  【運営】一般社団法人Japan Perl Association
</p>
<p>
  <a href="https://yapcjapan.connpass.com/event/146727/">YAPC::Nagoya::Tiny 2019</a>
</p>
</blockquote>
<h3>YAPC::Nagoya::Tinyの参加費、場所、時間</h3>
<p>
  YAPC::Nagoya::Tiny 2019の参加費は、1000円です。スポンサー企業様のご厚意によって、非常に安く設定されています。
</p>
<p>
  場所は、名古屋国際センター 第1会議室。
</p>
<p>
  時間は、10:30～18:00です。
</p>
<p>
  イベントの後は、懇親会もあります。懇親会は別途発表で、費用は別にかかります。普段はできない、プログラミングや技術の話でわいわい盛り上がります。
</p>
<h3>YAPC::Nagoya::Tiny 2019の申し込み</h3>
<p>
  申し込みは、conpassと呼ばれる、イベントを公表・申し込みができるWebサイトで受け付けています。
</p>
<p>
  中部地方、愛知県、名古屋の高校・大学の学生の皆様。研究者の皆様。インフラエンジニア、Webエンジニア、WebサービスをPerlで開発されているシステムマネージャ、経営者の方、奮ってご参加ください。
</p>
<p>
  遠方から名古屋へ旅行してみたいよーという方も、ご参加ください。
</p>
<p>
  Perl入学式のメンバーや、Perlゼミもconnpassで参加を申し込んでいるので、Perl入学式、過去に参加された方、Perlゼミ見ているよという方も、ぜひご参加ください。
</p>
<p>
  申し込みには、Paypalのアカウントが必要です。
</p>
<p>
  <a href="https://yapcjapan.connpass.com/event/146727/">YAPC::Nagoya::Tiny 2019の申し込みページに移動</a>
</p>


  </div>
  <div class="bottom">
    <!-- bottom -->
<!--
<hr>
<div style="width:90%;max-width:400px;background:#ffcef6;border: 1px solid #ff59e6;border-radius:3px;margin:10px auto;font-size:20px;">
<a rel="nofollow" href="https://perl-entrance-osaka.connpass.com/event/125719/"><img src="https://connpass-tokyo.s3.amazonaws.com/thumbs/c7/d9/c7d929370c08bcb1d0b37cc33f9b6b79.png" width="80px">Perl入学式大阪 大阪府大阪市北区芝田 2019年5月25日(土) 第一回 春季開校<br>Perlプログラミングを0から学ぼう。<br>テキスト処理,正規表現,if,for,変数</a>
</div>
-->

<div class="perlzemi-forum">
  <a rel="nofollow" href="https://docs.google.com/forms/d/e/1FAIpQLSe6ypMTx5XTh2KbsIgqgPMXNrC5Bo9FKRPVHM_o0jvrH_k28A/viewform">
    Perlゼミフォーラム - Perlプログラムの読み書きに困ったらここで質問(無料・5分で登録)
  </a>
</div>

  </div>
</div>

        </div>
        <div class="side">
          <div class="hatena-module">
  <div class="hatena-moduletitle">
    Perl入門
  </div>
  <div class="hatena-modulebody">
    <ul>
      <li>
        <a rel="nofollow" href="/list.html">新着情報</a>
      </li>
      <li>
        <a rel="nofollow" href="/blog/20180820153471.html">Perlのインストール</a>
      </li>
      <li>
        <a rel="nofollow" href="/blog/20091226126425.html">基礎文法最速マスター</a>
      </li>
      <li>
        <a rel="nofollow" href="/blog/20161012147627.html">配列</a>
      </li>
      <li>
        <a rel="nofollow" href="/blog/20161013147635.html">ハッシュ</a>
      </li>
      <li>
        <a rel="nofollow" href="/blog/20161023147731.html">条件分岐</a>
      </li>
      <li>
        <a rel="nofollow" href="/blog/20170521149524.html">繰り返し処理</a>
      </li>
      <li>
        <a rel="nofollow" href="/blog/20161003147558.html">文字列</a>
      </li>
      <li>
        <a rel="nofollow" href="/blog/20100827127859.html">正規表現</a>
      </li>
      <li>
        <a rel="nofollow" href="/blog/20100930127859.html">リファレンスと多次元データ構造</a>
      </li>
      <li>
        <a rel="nofollow" href="/blog/20101130129876.html">サブルーチン</a>
      </li>
      <li>
        <a rel="nofollow" href="/blog/20110212130370.html">ファイル入出力</a>
      </li>
      <li>
        <a rel="nofollow" href="/blog/20161107147852.html">変数</a>
      </li>
    </ul>
  </div>
</div>
<div class="hatena-module">
  <div class="hatena-moduletitle">
    Perl辞典
  </div>
  <div class="hatena-modulebody">
    <ul>
      <li>
        <a rel="nofollow" href="/blog/20161004147558.html">標準関数</a>
      </li>
      <li>
        <a rel="nofollow" href="/blog/20161022147731.html">構文・文法</a>
      </li>
      <li>
        <a rel="nofollow" href="/blog/20161005147566.html">演算子</a>
      </li>
      <li>
        <a rel="nofollow" href="/blog/20091116124667.html">モジュール</a>
      </li>
      <li>
        <a rel="nofollow" href="/blog/20161102147817.html">特殊変数</a>
      </li>
    </ul>
  </div>
</div>
<div class="hatena-module">
  <div class="hatena-moduletitle">
    Perl中級編
  </div>
  <div class="hatena-modulebody">
    <ul>
      <li>
        <a rel="nofollow" href="/blog/20100411127089.html">例外処理</a>
      </li>
      <li>
        <a rel="nofollow" href="/blog/20080108132865.html">コマンドライン引数</a>
      </li>
      <li>
        <a rel="nofollow" href="/blog/20100302126967.html">デバッガ</a>
      </li>
      <li>
        <a rel="nofollow" href="/blog/20161126148016.html">ファイル・ディレクトリ操作</a>
      </li>
      <li>
        <a rel="nofollow" href="/blog/20091120124667.html">現代的な記述方法</a>
      </li>
      <li>
        <a rel="nofollow" href="/blog/20130305136248.html">オブジェクト指向</a>
      </li>
      <li>
        <a rel="nofollow" href="/blog/20110128130016.html">スコープ</a>
      </li>
      <li>
        <a rel="nofollow" href="/blog/20091105124627.html">日付と時刻</a>
      </li>
      <li>
        <a rel="nofollow" href="/blog/20161026147748.html">数値計算</a>
      </li>
    </ul>
  </div>
</div>
<div class="hatena-module">
  <div class="hatena-moduletitle">
    Web開発
  </div>
  <div class="hatena-modulebody">
    <ul>
      <li>
        <a rel="nofollow" href="/blog/20140319139520.html">Mojolicious入門</a>
      </li>
    </ul>
  </div>
</div>
<div class="hatena-module">
  <div class="hatena-moduletitle">
    Perl発展編
  </div>
  <div class="hatena-modulebody">
    <ul>
      <li>
        <a rel="nofollow" href="/blog/20080229120427.html">Perl発展編</a>
      </li>
    </ul>
  </div>
</div>
<div class="hatena-module">
  <div class="hatena-moduletitle">
    サイト情報
  </div>
  <div class="hatena-modulebody">
    <ul>
      <li>
        <a rel="nofollow" href="/blog/20170917151092.html">サイト情報</a>
      </li>
    </ul>
  </div>
</div>
<div class="hatena-module">
  <div class="hatena-moduletitle">
    Perlの書籍
  </div>
  <div class="hatena-modulebody">
    <ul>
      <li>
        <a rel="nofollow" href="/blog/20120326133275.html"><img src="https://images-fe.ssl-images-amazon.com/images/I/51d4T7m8NzL._SL160_.jpg"></a><br>
        <span style="color:green">ログ解析など日本語を含むテキスト処理の実践ならこれ!Perlゼミ執筆のお勧め書籍</span>
      </li>
      <li>
        <a rel="nofollow" href="/blog/20120326133275.html">業務に役立つPerl</a>
      </li>
      <li>
        <a rel="nofollow" href="/blog/20180724153238.html">雅なPerl入門</a>
      </li>
    </ul>
  </div>
</div>
<div class="hatena-module">
  <div class="hatena-moduletitle">
    姉妹サイト
  </div>
  <div class="hatena-modulebody">
    <ul>
      <li>
        <a rel="nofollow" href="http://www.perlzemi.com">Perlゼミ公式サイト</a>
      </li>
      <li>
        <a rel="nofollow" href="https://twitter.com/perlzemi">Perlゼミ Twitter</a>
      </li>
      <li>
        <a rel="nofollow" href="https://philosophy.perlzemi.com/">Perlの哲学 - Perlに対する誤解を解きたい</a>
      </li>
      <li>
        <a href="https://linux.perlzemi.com/">Linuxサーバー管理入門</a>
      </li>
      <li>
        <a href="https://web.perlzemi.com/">Mojoliciousスタートアップ - 新規Web開発</a>
      </li>
      <li>
        <a rel="nofollow" href="https://yuki-kimoto.github.io">Perlゼミのオープンソースプロジェクト</a>
      </li>
      <li>
        <a rel="nofollow" href="https://newbie.perlzemi.com/">Perl Newbies</a>
      </li>
      <li>
        <div class="giblog-banner">
          <div>
            <a href="https://jp.giblog.net"><img src="/images/giblog-banner.png" alt="Giblog"></a>
          </div>
        </div>
        <a rel="nofollow" href="https://jp.giblog.net/">Giblog - Gitで管理できるサイト・ブログを作成するためのツール。Github PagesでWebサイトを無料で公開</a>
      </li>
    </ul>
  </div>
</div>
<div class="hatena-module">
  <div class="hatena-moduletitle">
    Perlイベント
  </div>
  <div class="hatena-modulebody">
    <a rel="nofollow" href="/blog/20190923084701.html"><img src="/images/yapc-nagoya.png" style="width:100%;"></a>
  </div>
</div>
<div class="hatena-module">
  <div class="hatena-moduletitle">
    お問合せ
  </div>
  <div class="hatena-modulebody">
    <a rel="nofollow" href="/mail.html">お問合せはこちら</a>
  </div>
</div>

        </div>
      </div>
      <div class="footer">
        <style>
.what-is-perl {
  width:95%;
  margin: 20px auto;
}
.what-is-perl b {
  padding-left:3px;
  padding-right:3px;
  font-size:103%;
}
.what-is-perl ul {
}
.what-is-perl li {
  list-style:none;
}
.what-is-perl img {
  width:100%;
  max-width:110px;
}

</style>

<div class="what-is-perl">
  <div>
    <img src="/images/perl-onion-logo.png">
  </div>
  <ul>
    <li><b>Perl</b>は、<b>テキスト処理</b>の記述性とパフォーマンスに優れ、<b>正規表現</b>が言語に組み込まれているプログラミング言語です。</li>
    <li><a href="https://linux.perlzemi.com" style="color:#666"><b>Linuxサーバー管理</b></a>での<b>フィルタリングプログラム</b>、複数行の文字列を処理、ファイル内容の検索・置換などが得意。<a href="https://web.perlzemi.com/" style="color:#666"><b>Mojoliciousを使ったWebスタートアップ</b></a>も。</li>
    <li>Perlは、<b>git</b>や<b>openssl</b>など<b>Unix/Linuxミドルウェア</b>の支援ツールとして採用されています。</li>
  </ul>
</div>

<!-- footer -->
<a rel="nofollow" href="http://www.perlzemi.com">Perlゼミのプログラミングスクールはこちら</a> & <a rel="nofollow" href="https://jp.giblog.net/">このサイトはGiblogで製作されています</a>

      </div>
    </div>
  </body>
</html>
